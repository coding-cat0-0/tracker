<div class="applications-container">
  <!-- ADMIN VIEW -->
  <div *ngIf="auth.isAdmin()" class="admin-view">
    <h1>Leave Applications</h1>
    
    <!-- Employee Filter Dropdown -->
    <div class="filter-section">
      <label for="employeeFilter">Filter by Employee:</label>
      <select 
        id="employeeFilter" 
        [(ngModel)]="selectedEmployeeId" 
        (change)="onEmployeeChange()"
        class="filter-dropdown">
        <option [value]="null">All Employees</option>
        <option *ngFor="let employee of employees" [value]="employee.id">
          {{ employee.name }} ({{ employee.email }})
        </option>
      </select>
    </div>

    <!-- Error Message -->
    <div *ngIf="errorMessage" class="error-message">
      {{ errorMessage }}
    </div>

    <!-- Loading State -->
    <div *ngIf="isLoading" class="loading">
      Loading applications...
    </div>

    <!-- Applications Grid -->
    <div *ngIf="!isLoading && applications.length > 0" class="applications-grid">
      <div *ngFor="let app of applications" class="application-card">
        <!-- Header with Username -->
        <div class="card-header">
          <h3 class="username">{{ getEmployeeName(app.employee_id) }}</h3>
        </div>

        <!-- Content -->
        <div class="card-content">
          <!-- Reason Badge -->
          <div class="reason-badge" [ngClass]="'reason-' + app.reason">
            {{ app.reason | uppercase }}
          </div>

          <!-- Body/Description (if provided or if reason is 'other') -->
          <div *ngIf="app.body || app.reason === 'other'" class="body-section">
            <p class="body-text">{{ app.body || 'No description provided' }}</p>
          </div>

          <!-- Status Badge -->
          <div class="status-badge" [ngClass]="'status-' + app.status">
            {{ app.status | uppercase }}
          </div>

          <!-- Date -->
          <p class="date">{{ app.created_at | date:'short' }}</p>
        </div>

        <!-- Action Buttons (only for pending applications) -->
        <div *ngIf="app.status === 'pending'" class="card-footer">
          <button 
            class="btn btn-accept" 
            (click)="acceptApplication(app.id)"
            title="Accept this application">
            Accept
          </button>
          <button 
            class="btn btn-reject" 
            (click)="rejectApplication(app.id)"
            title="Reject this application">
            Reject
          </button>
        </div>
      </div>
    </div>

    <!-- No Applications -->
    <div *ngIf="!isLoading && applications.length === 0" class="no-applications">
      No applications found
    </div>
  </div>

  <!-- EMPLOYEE VIEW -->
  <div *ngIf="auth.isEmployee()" class="employee-view">
    <h1>My Applications</h1>

    <!-- Submit New Application Section -->
    <div class="submit-section">
      <h2>Submit New Leave Application</h2>
      <div class="form-group">
        <label for="reason">Reason for Leave:</label>
        <select 
          id="reason" 
          [(ngModel)]="reason" 
          class="form-control">
          <option value="">Select a reason</option>
          <option value="casual">Casual Leave</option>
          <option value="sick">Sick Leave</option>
          <option value="other">Other</option>
        </select>
      </div>

      <div class="form-group">
        <label for="body">Description:</label>
        <textarea 
          id="body" 
          [(ngModel)]="body" 
          class="form-control"
          placeholder="Enter reason (mandatory for 'Other' reason)"
          rows="3"></textarea>
      </div>

      <button 
        (click)="submitApplication()" 
        [disabled]="isLoading"
        class="btn btn-submit">
        Submit Application
      </button>
    </div>

    <!-- Error/Success Messages -->
    <div *ngIf="errorMessage" class="error-message">
      {{ errorMessage }}
    </div>

    <!-- Status Filter Dropdown -->
    <div class="filter-section">
      <label for="statusFilter">Filter by Status:</label>
      <select 
        id="statusFilter" 
        [(ngModel)]="selectedStatus" 
        (change)="filterApplicationsByStatus()"
        class="filter-dropdown">
        <option value="pending">Pending</option>
        <option value="accepted">Accepted</option>
        <option value="rejected">Rejected</option>
      </select>
    </div>

    <!-- Loading State -->
    <div *ngIf="isLoading" class="loading">
      Loading your applications...
    </div>

    <!-- Applications Grid -->
    <div *ngIf="!isLoading && filteredApplications.length > 0" class="applications-grid">
      <div *ngFor="let app of filteredApplications" class="application-card employee-card">
        <!-- Header -->
        <div class="card-header">
          <h3>Leave Application</h3>
        </div>

        <!-- Content -->
        <div class="card-content">
          <!-- Reason Badge -->
          <div class="reason-badge" [ngClass]="'reason-' + app.reason">
            {{ app.reason | uppercase }}
          </div>

          <!-- Body/Description -->
          <div *ngIf="app.body || app.reason === 'other'" class="body-section">
            <p class="body-text">{{ app.body || 'No description provided' }}</p>
          </div>

          <!-- Status Badge -->
          <div class="status-badge" [ngClass]="'status-' + app.status">
            {{ app.status | uppercase }}
          </div>

          <!-- Date -->
          <p class="date">{{ app.created_at | date:'short' }}</p>
        </div>

        <!-- Delete Button (only for pending applications) -->
        <div *ngIf="app.status === 'pending'" class="card-footer">
          <button 
            class="btn btn-delete" 
            (click)="deleteApplication(app.id)"
            title="Delete this application">
            Delete
          </button>
        </div>
      </div>
    </div>

    <!-- No Applications -->
    <div *ngIf="!isLoading && filteredApplications.length === 0" class="no-applications">
      No {{ selectedStatus }} applications found
    </div>
  </div>
</div>
