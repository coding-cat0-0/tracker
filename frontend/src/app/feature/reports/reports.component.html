<div class="applications-container">
  <!-- ADMIN VIEW -->
  <div *ngIf="auth.isAdmin()" class="admin-view">
    <h1>Applications</h1>
    
    <!-- Filter Section (Admin) -->
    <div class="filter-section">
      <div class="filter-group">
        <label for="employeeFilter">Filter by Employee:</label>
        <select 
          id="employeeFilter" 
          [(ngModel)]="selectedEmployeeId" 
          (change)="onEmployeeChange()"
          class="filter-dropdown">
          <option [value]="null">All Employees</option>
          <option *ngFor="let employee of employees" [value]="employee.id">
            {{ employee.username }}
          </option>
        </select>
      </div>

      <div class="filter-group">
        <label for="adminStatusFilter">Filter by Status:</label>
        <select 
          id="adminStatusFilter" 
          [(ngModel)]="selectedStatus" 
          (change)="filterApplicationsByStatus()"
          class="filter-dropdown">
          <option value="all">All</option>
          <option value="pending">Pending</option>
          <option value="accepted">Accepted</option>
          <option value="rejected">Rejected</option>
        </select>
      </div>
    </div>

    <!-- Error Message -->
    <div *ngIf="errorMessage" class="error-message">
      {{ errorMessage }}
    </div>

    <!-- Loading State -->
    <div *ngIf="isLoading" class="loading">
      Loading applications...
    </div>

    <!-- Applications Grid -->
    <div *ngIf="!isLoading && applications.length > 0" class="applications-grid">
      <div *ngFor="let app of applications" class="application-card">
        <!-- Header with Username -->
        <div class="card-header">
          <div class="avatar-circle">
            {{ getEmployeeName(app.employee_id).charAt(0).toUpperCase() }}
          </div>
          <h3 class="username">{{ getEmployeeName(app.employee_id) }}</h3>
        </div>

        <!-- Content -->
        <div class="card-content">
          <!-- Top Row: Labels -->
          <div class="meta-row">
            <div class="info-item">
              <span class="info-label">Reason:</span>
              <div class="reason-badge" [ngClass]="'reason-' + app.reason">
                {{ app.reason | uppercase }}
              </div>
            </div>

            <div class="info-item">
              <span class="info-label">Status:</span>
              <div class="status-badge" [ngClass]="'status-' + app.status">
                {{ app.status | uppercase }}
              </div>
            </div>

            <div class="info-item">
              <span class="info-label">Date:</span>
              <p class="date">{{ app.created_at | date:'short' }}</p>
            </div>
          </div>

          <!-- Bottom Row: Description -->
          <div *ngIf="app.body || app.reason === 'other'" class="body-section">
            <span class="info-label">Description:</span>
            <p class="body-text">{{ app.body || 'No description provided' }}</p>
          </div>
        </div>

        <!-- Action Buttons (only for pending applications) -->
        <div *ngIf="app.status === 'pending'" class="card-footer">
          <button 
            class="btn btn-accept" 
            (click)="acceptApplication(app.id)"
            title="Accept this application">
            Accept
          </button>
          <button 
            class="btn btn-reject" 
            (click)="rejectApplication(app.id)"
            title="Reject this application">
            Reject
          </button>
        </div>
      </div>
    </div>

    <!-- No Applications -->
    <div *ngIf="!isLoading && applications.length === 0" class="no-applications">
      No applications found
    </div>
  </div>

  <!-- EMPLOYEE VIEW -->
  <div *ngIf="auth.isEmployee()" class="employee-view">
    <h1>My Applications</h1>
    
    <div class="filter-section">
       <div class="filter-group">
          <label for="statusFilter">Filter by Status:</label>
          <select 
            id="statusFilter" 
            [(ngModel)]="selectedStatus" 
            (change)="filterApplicationsByStatus()"
            class="filter-dropdown">
            <option value="all">All</option>
            <option value="pending">Pending</option>
            <option value="accepted">Accepted</option>
            <option value="rejected">Rejected</option>
          </select>
       </div>

       <button 
          class="btn btn-submit" 
          (click)="showApplicationForm = true">
           Create
       </button>
    </div>
    
    <div class="modal-overlay" *ngIf="showApplicationForm">
      <div class="submit-section">
      <h2>Submit New Leave Application</h2>
      
      <div class="form-group">
        <label for="reason">Reason for Leave:</label>
        <select 
          id="reason" 
          [(ngModel)]="reason" 
          class="form-control">
          <option value="">Select a reason</option>
          <option value="casual">Casual Leave</option>
          <option value="sick">Sick Leave</option>
          <option value="other">Other</option>
        </select>
      </div>

      <div class="form-group">
        <label for="body">Description:</label>
        <textarea 
          id="body" 
          [(ngModel)]="body" 
          class="form-control"
          placeholder="Enter reason (mandatory for 'Other' reason)"
          rows="3"></textarea>
      </div>

      <div class="form-actions">
        <button class="btn btn-reject" (click)="showApplicationForm = false">Cancel</button>
        <button 
          (click)="submitApplication()" 
          [disabled]="isLoading"
          class="btn btn-save">
          <span *ngIf="!isLoading">Save</span>
          <span *ngIf="isLoading">Saving...</span>
        </button>
      </div>
    </div>
    </div>

    <!-- Error/Success Messages -->
    <div *ngIf="errorMessage" class="error-message">
      {{ errorMessage }}
    </div>

    <!-- Loading State -->
    <div *ngIf="isLoading" class="loading">
      Loading your applications...
    </div>

    <!-- Applications Grid -->
    <div *ngIf="!isLoading && filteredApplications.length > 0" class="applications-grid">
      <div *ngFor="let app of filteredApplications" class="application-card employee-card">

        <div class="card-content">
          <!-- Top Row: Labels -->
          <div class="meta-row">
            <div class="info-item">
              <span class="info-label">Reason:</span>
              <div class="reason-badge" [ngClass]="'reason-' + app.reason">
                {{ app.reason | uppercase }}
              </div>
            </div>

            <div class="info-item">
              <span class="info-label">Status:</span>
              <div class="status-badge" [ngClass]="'status-' + app.status">
                {{ app.status | uppercase }}
              </div>
            </div>

            <div class="info-item">
              <span class="info-label">Date:</span>
              <p class="date">{{ app.created_at | date:'short' }}</p>
            </div>
          </div>

          <!-- Bottom Row: Description -->
          <div *ngIf="app.body || app.reason === 'other'" class="body-section">
            <span class="info-label">Description:</span>
            <p class="body-text">{{ app.body || 'No description provided' }}</p>
          </div>
        </div>

        <!-- Delete Button (only for pending applications) -->
        <div *ngIf="app.status === 'pending'" class="card-footer">
          <button 
            class="btn btn-delete" 
            (click)="deleteApplication(app.id)"
            title="Delete this application">
            Delete
          </button>
        </div>
      </div>
    </div>

    <!-- No Applications -->
    <div *ngIf="!isLoading && filteredApplications.length === 0" class="no-applications">
      No {{ selectedStatus }} applications found
    </div>
  </div>
</div>
